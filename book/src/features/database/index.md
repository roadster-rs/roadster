# Database

<!--todo: Fix broken links once 0.7.0 is released-->

Roadster provides built-in support for both [SeaORM](https://docs.rs/sea-orm) and [Diesel](https://docs.rs/diesel).

## SeaORM

When the `db-sea-orm` feature is enabled, Roadster provides support for various SQL databases
via [SeaORM](https://docs.rs/sea-orm/), an ORM built on top of [sqlx](https://docs.rs/sqlx/latest/sqlx/).
See the SeaORM docs for more details.

### Migrator

To run your SeaORM migrations with Roadster, provide
your [`MigratorTrait`](https://docs.rs/sea-orm-migration/1.1.4/sea_orm_migration/migrator/trait.MigratorTrait.html) type
to Roadster. This is done by providing the migrator via the
[
`RoadsterAppBuilder#sea_orm_migrator`](https://docs.rs/roadster/0.7.0-alpha.4/roadster/app/struct.RoadsterAppBuilder.html#method.sea_orm_migrator)
method

```rust,ignore
{{#include ../../../examples/database/src/roadster_app.rs:6:}}
```

or the
[`App#migrators`](https://docs.rs/roadster/0.7.0-alpha.4/roadster/app/trait.App.html#method.migrators) impl

```rust,ignore
{{#include ../../../examples/database/src/app.rs:8:}}
```

### Migration utilities

Roadster provides some utilities for defining common column types with SeaORM. See
the [`migration`](https://docs.rs/roadster/latest/roadster/migration/index.html) module docs for the list of
utilities.

## Diesel

When one of the `db-diesel-*` features is enabled, Roadster provides support for various SQL databases
via [Diesel](https://docs.rs/diesel/). See the Diesel docs for more details.

### Diesel connection pool

Because of Diesel's strong typing, Roadster has different features for each DB backend, each of which enables the
respective DB connection pool. In addition to the non-async connections provided by [diesel](https://docs.rs/diesel),
async versions of the Postgres and Mysql connections are supported via [diesel-async](https://docs.rs/diesel-async).

| Feature                         | Connection type    |
|---------------------------------|--------------------|
| `db-diesel-postgres-pool`       | Non-async Postgres |          
| `db-diesel-mysql-pool`          | Non-async Mysql    |          
| `db-diesel-sqlite-pool`         | Non-async Sqlite   |          
| `db-diesel-postgres-pool-async` | Async Postgres     |          
| `db-diesel-mysql-pool-async`    | Async Mysql        |          

### Migrator

To run your Diesel migrations with Roadster, provide
your migrations to Roadster. This is done by setting providing the migrator in the
[
`RoadsterAppBuilder#diesel_migrator`](https://docs.rs/roadster/0.7.0-alpha.4/roadster/app/struct.RoadsterAppBuilder.html#method.sea_orm_migrator)
method

```rust,ignore
{{#include ../../../examples/database-diesel/src/roadster_app.rs:7:}}
```

or the
[`App#migrators`](https://docs.rs/roadster/0.7.0-alpha.4/roadster/app/trait.App.html#method.migrators) impl

```rust,ignore
{{#include ../../../examples/database-diesel/src/app.rs:8:}}
```

## Running migrations

### Automatically

Roadster can automatically run your migrations when your app is starting. This behavior is configured by the
[
`database.auto-migrate`](https://docs.rs/roadster/latest/roadster/config/database/struct.Database.html#structfield.auto_migrate)
config field.

```toml
[database]
auto-migrate = true # change to `false` to disable
```

### Via the Roadster CLI

You can also manually run migrations via the CLI (when the `cli` feature is enabled).

```shell
cargo run -- roadster migrate up
```

Note that this does not generate schemas/entities that may be generated by the SeaORM/Diesel CLI utilities. This only
runs the migrations on the connected DB.

### Via ORM CLI

#### SeaORM

```shell
sea migrate up
```

See: <https://crates.io/crates/sea-orm-cli>

#### Diesel

```shell
diesel migration run
```

See: <https://crates.io/crates/diesel_cli>

<style>
table  {
    width: 100%;
}
</style>