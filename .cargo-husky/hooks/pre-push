#!/usr/bin/env bash

# Exit immediately if any command returns non-zero exit status.
set -e

# `fmt` doesn't depend on which features are enabled
echo "### fmt --all --check ###"
cargo fmt --all --check

echo "### cargo doc --all-features --no-deps ###"
RUSTDOCFLAGS="-D warnings" cargo doc --all-features --no-deps

# With no features
echo "### test --no-default-features --workspace ###"
cargo test --no-default-features --workspace
echo "### check --no-default-features --workspace ###"
cargo check --no-default-features --workspace
echo "### clippy --workspace --all-targets --no-default-features -- -D warnings ###"
cargo clippy --workspace --all-targets --no-default-features -- -D warnings

# With default features
echo "### test --workspace ###"
cargo test --workspace
echo "### check --workspace ###"
cargo check --workspace
echo "### clippy --workspace --all-targets -- -D warnings ###"
cargo clippy --workspace --all-targets -- -D warnings

# With all features
echo "### test --all-features --workspace ###"
cargo test --all-features --workspace
echo "### check --all-features --workspace ###"
cargo check --all-features --workspace
echo "### clippy --workspace --all-targets --all-features -- -D warnings ###"
cargo clippy --workspace --all-targets --all-features -- -D warnings
